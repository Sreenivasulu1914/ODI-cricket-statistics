{% extends "base.html" %}

{% block content %}
<div class="container-fluid">
    <div class="row">




        <nav class="col-md-3 d-none d-md-block  sidebar"
            style="color:black !important;padding-top: 200px;padding-left: 50px;padding-right: 60px; position: fixed; top: 250;bottom: 100; height: 100vh;">
            <ul class="nav flex-column" >
                <li class="nav-item" style="color: white !important">
                    <a style="color: white !important" class="nav-link" href="#top_batsmen">Top Batsmen</a>
                </li>
                <hr>
                <li class="nav-item" style="color:black !important">
                    <a style="color:white !important" class="nav-link" href="#top_bowlers">Top Bowlers</a>
                </li>
                <hr>
                <li class="nav-item" style="color:black !important">
                    <a style="color:white !important" class="nav-link" href="#top_batting_averages">Top Batting
                        Averages</a>
                </li>
                <hr>
                <li class="nav-item" style="color:black !important">
                    <a style="color:white !important" class="nav-link" href="#top_economy_bowlers">Top Economy
                        Bowlers</a>
                </li>
                <hr>
            </ul>
        </nav>

        <!-- Collapsible Navbar for Mobile -->
        <nav class="navbar navbar-expand-md navbar-light bg-light d-md-none">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="#top_batsmen">Top Batsmen</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#top_bowlers">Top Bowlers</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#top_batting_averages">Top Batting Averages</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#top_economy_bowlers">Top Economy Bowlers</a>
                    </li>
                </ul>
            </div>
        </nav>

        <div class="col-md-9 offset-md-3">
            <h1 class="text-center img-logo-player"
               
                >
                <p style="font-size: 50px; font-weight: bolder;">ICC ODI World Ranking</p>
            </h1>
            <div class="content">


                <div class="col-md-9 ml-sm-auto col-lg-9 px-4">
                    <div
                        class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 ">
                        <!-- <h1 class="h2">Players</h1> -->
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" id="player-search-input"
                                placeholder="Search for a player...">
                            <div class="input-group-append">
                                <button class="btn btn-primary " type="button"
                                    id="player-search-btn" >Search</button>
                            </div>
                        </div>
                    </div>

                    <!-- Search Results -->
                    <div id="player-search-results" class="row">
                        <!-- Player search results will be inserted here by JavaScript -->
                    </div>

                    <!-- Player Info
                    <div id="player-info" class="mt-4">
                         Player info will be inserted here by JavaScript 
                    </div> -->
                </div>



                <h2 id="top_batsmen" class="mt-4 text-center">Top Batsmen</h2>
                
                <div class="row">
                    <div class="col-md-12">
                        <table class="table ">
                            <thead class="thead-dark" style="background-color: black;color: white;">
                                <tr>
                                    <th scope="col">S.No</th>
                                    <th scope="col">Team</th>
                                    <th scope="col">Player Name</th>
                                    <th scope="col">Total Runs</th>
                                    <th scope="col">Action</th>
                                </tr>
                            </thead>
                            <tbody id="batsmen-table-body">
                                {% for batsman in top_batsmen %}
                                <tr>
                                    <th scope="row">{{ loop.index }}</th>
                                    <td>
                                        <img src="{{ url_for('static', filename=batsman.country_image) }}"
                                            alt="{{ batsman.country_name }} logo" style="width: 30px; height: 20px;">
                                        {{ batsman.country_name }}
                                    </td>
                                    <td>{{ batsman.player_name }}</td>
                                    <td>{{ batsman.total_runs }}</td>
                                    <td>
                                        <a href="{{ url_for('player_info', player_id=batsman.player_id) }}"
                                            class="btn btn-primary">View More</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        <button id="view-more-batsmen" class="btn btn-secondary">View More</button>
                    </div>
                </div>

                <h2 id="top_bowlers" class="mt-4 text-center">Top Bowlers</h2>
             
                <div class="row">
                    <div class="col-md-12">
                        <table class="table ">
                            <thead class="thead-dark" style="background-color: black;color: white;">
                                <tr>
                                    <th scope="col">S.No</th>
                                    <th scope="col">Team</th>
                                    <th scope="col">Player Name</th>
                                    <th scope="col">Total Wickets</th>
                                    <th scope="col">Action</th>
                                </tr>
                            </thead>
                            <tbody id="bowlers-table-body">
                                {% for bowler in top_bowlers %}
                                <tr>
                                    <th scope="row">{{ loop.index }}</th>
                                    <td>
                                        <img src="{{ url_for('static', filename=bowler.country_image) }}"
                                            alt="{{ bowler.country_name }} logo" style="width: 30px; height: 20px;">
                                        {{ bowler.country_name }}
                                    </td>
                                    <td>{{ bowler.player_name }}</td>
                                    <td>{{ bowler.total_wickets }}</td>
                                    <td>
                                        <a href="{{ url_for('player_info', player_id=bowler.player_id) }}"
                                            class="btn btn-primary">View More</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        <button id="view-more-bowlers" class="btn btn-secondary">View More</button>
                    </div>
                </div>

                <h2 id="top_batting_averages" class="mt-4 text-center">Top Batting Averages</h2>
            
                <div class="row">
                    <div class="col-md-12">
                        <table class="table ">
                            <thead class="thead-dark" style="background-color: black;color: white;">
                                <tr>
                                    <th scope="col">S.No</th>
                                    <th scope="col">Team</th>
                                    <th scope="col">Player Name</th>
                                    <th scope="col">Batting Average</th>
                                    <th scope="col">Action</th>
                                </tr>
                            </thead>
                            <tbody id="batting-averages-table-body">
                                {% for batsman in top_batting_averages %}
                                <tr>
                                    <th scope="row">{{ loop.index }}</th>
                                    <td>
                                        <img src="{{ url_for('static', filename=batsman.country_image) }}"
                                            alt="{{ batsman.country_name }} logo" style="width: 30px; height: 20px;">
                                        {{ batsman.country_name }}
                                    </td>
                                    <td>{{ batsman.player_name }}</td>
                                    <td>{{ batsman.batting_average }}</td>
                                    <td>
                                        <a href="{{ url_for('player_info', player_id=batsman.player_id) }}"
                                            class="btn btn-primary">View More</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        <button id="view-more-batting-averages" class="btn btn-secondary">View More</button>
                    </div>
                </div>

                <h2 id="top_economy_bowlers" class="mt-4 text-center">Top Economy Bowlers</h2>
              
                <div class="row">
                    <div class="col-md-12">
                        <table class="table ">
                            <thead class="thead-dark" style="background-color: black;color: white;">
                                <tr>
                                    <th scope="col">S.No</th>
                                    <th scope="col">Team</th>
                                    <th scope="col">Player Name</th>
                                    <th scope="col">Economy Rate</th>
                                    <th scope="col">Action</th>
                                </tr>
                            </thead>
                            <tbody id="economy-bowlers-table-body">
                                {% for bowler in top_economy_bowlers %}
                                <tr>
                                    <th scope="row">{{ loop.index }}</th>
                                    <td>
                                        <img src="{{ url_for('static', filename=bowler.country_image) }}"
                                            alt="{{ bowler.country_name }} logo" style="width: 30px; height: 20px;">
                                        {{ bowler.country_name }}
                                    </td>
                                    <td>{{ bowler.player_name }}</td>
                                    <td>{{ bowler.economy_rate }}</td>
                                    <td>
                                        <a href="{{ url_for('player_info', player_id=bowler.player_id) }}"
                                            class="btn btn-primary">View More</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        <button id="view-more-economy-bowlers" class="btn btn-secondary">View More</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let batsmenOffset = 10;
    let bowlersOffset = 10;
    let battingAveragesOffset = 10;
    let economyBowlersOffset = 10;

    document.getElementById('view-more-batsmen').addEventListener('click', function () {
        fetch(`/load_more_batsmen?offset=${batsmenOffset}`)
            .then(response => response.json())
            .then(data => {
                const tableBody = document.getElementById('batsmen-table-body');
                data.forEach((batsman, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <th scope="row">${batsmenOffset + index + 1}</th>
                        <td> <img src="/static/${batsman.country_image}" alt="${batsman.country_name} logo" style="width: 30px; height: 20px;"> ${batsman.country_name} </td>

                        <td>${batsman.player_name}</td>
                        <td>${batsman.total_runs}</td>
                        <td><a href="/player_info/${batsman.player_id}" class="btn btn-primary">View More</a></td>
                    `;
                    tableBody.appendChild(row);
                });
                batsmenOffset += 10;
            });
    });

    document.getElementById('view-more-bowlers').addEventListener('click', function () {
        fetch(`/load_more_bowlers?offset=${bowlersOffset}`)
            .then(response => response.json())
            .then(data => {
                const tableBody = document.getElementById('bowlers-table-body');
                data.forEach((bowler, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <th scope="row">${bowlersOffset + index + 1}</th>
                        <td> <img src="/static/${bowler.country_image}" alt="${bowler.country_name} logo" style="width: 30px; height: 20px;"> ${bowler.country_name}</td>


                        <td>${bowler.player_name}</td>
                        <td>${bowler.total_wickets}</td>
                        <td><a href="/player_info/${bowler.player_id}" class="btn btn-primary">View More</a></td>
                    `;
                    tableBody.appendChild(row);
                });
                bowlersOffset += 10;
            });
    });

    document.getElementById('view-more-batting-averages').addEventListener('click', function () {
        fetch(`/load_more_batting_averages?offset=${battingAveragesOffset}`)
            .then(response => response.json())
            .then(data => {
                const tableBody = document.getElementById('batting-averages-table-body');
                data.forEach((batsman, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <th scope="row">${battingAveragesOffset + index + 1}</th>
                        <td> <img src="/static/${batsman.country_image}" alt="${batsman.country_name} logo" style="width: 30px; height: 20px;"> ${batsman.country_name}</td>

                        <td>${batsman.player_name}</td>
                        <td>${batsman.batting_average}</td>
                        <td><a href="/player_info/${batsman.player_id}" class="btn btn-primary">View More</a></td>
                    `;
                    tableBody.appendChild(row);
                });
                battingAveragesOffset += 10;
            });
    });

    document.getElementById('view-more-economy-bowlers').addEventListener('click', function () {
        fetch(`/load_more_economy_bowlers?offset=${economyBowlersOffset}`)
            .then(response => response.json())
            .then(data => {
                const tableBody = document.getElementById('economy-bowlers-table-body');
                data.forEach((bowler, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <th scope="row">${economyBowlersOffset + index + 1}</th>
                        <td><img src="/static/${bowler.country_image}" alt="${bowler.country_name} logo" style="width: 30px; height: 20px;">   ${bowler.country_name}</td>

                        <td>${bowler.player_name}</td>
                        <td>${bowler.economy_rate}</td>
                        <td><a href="/player_info/${bowler.player_id}" class="btn btn-primary">View More</a></td>
                    `;
                    tableBody.appendChild(row);
                });
                economyBowlersOffset += 10;
            });
    });
</script>



<script>

    document.getElementById('player-search-btn').addEventListener('click', function() {
        const searchQuery = document.getElementById('player-search-input').value;
        fetch(`/search_players?query=${searchQuery}`)
            .then(response => response.json())
            .then(data => {
                const resultsContainer = document.getElementById('player-search-results');
                resultsContainer.innerHTML = '';
                if (data.error) {
                    resultsContainer.innerHTML = `<p>${data.error}</p>`;
                } else {
                    data.forEach(player => {
                        const playerCard = document.createElement('div');
                        playerCard.className = 'col-md-4 player-card';
                        playerCard.innerHTML = `
                            <div class="card mb-4 shadow-sm" style="height:150px !important">
                                <div class="card-body">
                                    <h5 class="card-title" style ="color:black !important;">${player.name}</h5>
                                    <p class="card-text">${player.country}</p>
                                    <a href="/player_detail/${player.id}" class="btn btn-primary">View More</a>
                                </div>
                            </div>
                        `;
                        resultsContainer.appendChild(playerCard);
                    });
                }
            })
            .catch(error => {
                console.error('Error fetching player data:', error);
            });
    });

</script>
{% endblock %}